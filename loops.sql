DELIMITER //
CREATE PROCEDURE repete_consulta0016___ (limite TINYINT UNSIGNED)
BEGIN
    DECLARE contador TINYINT UNSIGNED DEFAULT 0;
    loop_teste: LOOP
        SET contador = contador + 1;
        
        IF contador >= limite THEN
            leave loop_teste;
        END IF;
		



		
CREATE VIEW REVENUE0 (SUPPLIER_NO, TOTAL_REVENUE) AS
	SELECT
		L_SUPPKEY,
		SUM(L_EXTENDEDPRICE * (1 - L_DISCOUNT))
	FROM
		LINEITEM
	WHERE
		L_SHIPDATE >= DATE '1997-07-01'
		AND L_SHIPDATE < DATE '1997-07-01' + INTERVAL '3' MONTH
	GROUP BY
		L_SUPPKEY;


SELECT
	P_BRAND,
	P_TYPE,
	P_SIZE,
	COUNT(DISTINCT PS_SUPPKEY) AS SUPPLIER_CNT
FROM
	PARTSUPP,
	PART
WHERE
	P_PARTKEY = PS_PARTKEY
	AND P_BRAND <> 'BRAND#34'
	AND P_TYPE NOT LIKE 'LARGE BRUSHED%'
	AND P_SIZE IN (48, 19, 12, 4, 41, 7, 21, 39)
	AND PS_SUPPKEY NOT IN (
		SELECT
			S_SUPPKEY
		FROM
			SUPPLIER
		WHERE
			S_COMMENT LIKE '%CUSTOMER%COMPLAINTS%'
	)
GROUP BY
	P_BRAND,
	P_TYPE,
	P_SIZE
ORDER BY
	SUPPLIER_CNT DESC,
	P_BRAND,
	P_TYPE,
	P_SIZE;

DROP VIEW REVENUE0;


    END loop loop_teste;
END//
DELIMITER ;

-- Testando:
CALL repete_consulta0016___(31);